# Automated 3-Tier PHP Application Deployment using Terraform & Ansible

This project demonstrates a **fully automated 3-Tier Architecture deployment on AWS** using **Terraform** and **Ansible**, where a **single `terraform apply` command** provisions the complete infrastructure and performs application configuration and deployment without any manual intervention.

Terraform is used for **Infrastructure as Code**, while Ansible handles **configuration management**. Terraform dynamically generates the Ansible inventory and automatically triggers the Ansible playbook execution, resulting in a seamless end-to-end DevOps workflow.

---

## âž¤ Key Features

- Single-command deployment using `terraform apply`
- Fully automated Ansible execution
- Dynamic Ansible inventory generation from Terraform outputs
- Role-based Ansible architecture
- Secure 3-Tier AWS design
- Nginx reverse proxy running on port **81**
- Private subnets secured using a NAT Gateway
- Remote Terraform state stored in Amazon S3
- Industry-style DevOps workflow

---

## âž¤ Architecture Overview

The architecture follows a standard **3-Tier Architecture**:

### ðŸ”¹ Proxy Layer (Public Subnet)
- Nginx reverse proxy
- Listens on port **81**
- Exposes application to the internet
- Assigned a public IP
- Acts as a Bastion (Jump Server)

### ðŸ”¹ Application Layer (Private Subnet)
- Nginx + PHP + PHP-FPM
- Hosts PHP web application
- Communicates internally with database

### ðŸ”¹ Database Layer (Private Subnet)
- MariaDB server
- Stores application data
- No public access

---

## âž¤ Request Flow
```
User
|
| http://<Proxy_Public_IP>:81
|
Nginx Proxy (Public Subnet)
|
Application Server (Private Subnet)
|
MariaDB Server (Private Subnet)

```

---

## âž¤ Technologies Used

- Cloud Provider: AWS
- Infrastructure as Code: Terraform
- Configuration Management: Ansible
- Web Server: Nginx
- Backend: PHP (PHP-FPM)
- Database: MariaDB
- Operating System: Amazon Linux
- Terraform State Backend: Amazon S3

---

## âž¤ Project Structure
```
.
â”œâ”€â”€ terraform/
â”‚ â”œâ”€â”€ main.tf
â”‚ â”œâ”€â”€ variable.tf
â”‚ â”œâ”€â”€ output.tf
â”‚ â””â”€â”€ inventory.tmpl
â”‚
â”œâ”€â”€ ansible/
â”‚ â”œâ”€â”€ inventory.ini # Auto-generated by Terraform
â”‚ â”œâ”€â”€ playbook.yml
â”‚ â””â”€â”€ roles/
â”‚   â”œâ”€â”€ proxy/
â”‚   â”œâ”€â”€ app/
â”‚   â””â”€â”€ db/
â”‚
â”œâ”€â”€ images/
â”‚
â””â”€â”€ README.md
```

---

## âž¤ Infrastructure Provisioning (Terraform)

Terraform provisions the complete AWS infrastructure, including:

- Custom VPC (10.0.0.0/16)
- 1 Public Subnet
- 2 Private Subnets
- Internet Gateway
- NAT Gateway
- Route Tables and Subnet Associations
- Security Groups
- EC2 Instances:
  - Proxy Server
  - Application Server
  - Database Server
- Remote Terraform backend using Amazon S3


---

## âž¤ Automated Ansible Integration

This project implements **full automation between Terraform and Ansible**, ensuring that once infrastructure is provisioned, configuration and application deployment happen automatically without any manual steps.

---

### ðŸ”¹ Dynamic Inventory Generation

- Terraform dynamically generates the Ansible inventory using a template file (`inventory.tmpl`)
- Instance IP addresses are fetched directly from Terraform-managed AWS resources
- The rendered inventory is automatically written to:

```
ansible/inventory.ini
```

This eliminates the need for manually maintaining host IPs or inventory files.

---

### ðŸ”¹ Terraform-Driven Ansible Execution

Terraform triggers Ansible execution using a `null_resource` with a `local-exec` provisioner:

- Waits for EC2 instances to become fully ready
- Switches execution context to the Ansible directory
- Executes the Ansible playbook automatically
- Uses SSH via the proxy (bastion) server for secure access to private instances

No manual SSH login or `ansible-playbook` command is required.

---

## âž¤ Deployment (Single Command)

The entire infrastructure provisioning and application deployment process is executed using a single command:

```bash
terraform apply --auto-approve
```

---

## âž¤ Security Group Configuration

The security group is configured to allow **only the required traffic** between different tiers of the application, ensuring a secure deployment.

| Port | Purpose |
|------|--------|
| 22   | SSH access |
| 81   | Public access via Nginx proxy |
| 80   | Internal HTTP communication |
| 3306 | MariaDB database access |

The proxy server is intentionally configured to listen on **port 81**, and this port is explicitly allowed in the security group to expose the application.

---

## âž¤ Configuration Management (Ansible Roles)

Ansible uses a **role-based architecture** to maintain clean, modular, and scalable configuration management.

---

### ðŸ”¹ Proxy Role

- Installs Nginx
- Configures Nginx as a reverse proxy
- Listens on port **81**
- Forwards incoming requests to the application server
- Acts as a bastion host for SSH access to private servers

---

### ðŸ”¹ App Role

- Installs Nginx, PHP, and PHP-FPM
- Deploys the PHP web application
- Configures application-to-database connectivity
- Ensures required services are enabled and running

---

### ðŸ”¹ DB Role

- Installs MariaDB server
- Creates application database and user
- Grants required database privileges
- Enables remote database access
- Uses **PyMySQL** for Ansible database automation

---

## âž¤ Application Details

- Simple PHP-based web application
- Accepts user input via an HTML form
- Stores submitted data in MariaDB
- Retrieves and displays stored records
- End-to-end data flow is verified

---

## âž¤ Security Design Highlights

- Application and database servers are deployed in **private subnets**
- No public IP addresses are assigned to private instances
- NAT Gateway enables outbound internet access for private servers
- Proxy server is used as a **bastion host** (we must manually copy the private key to proxy server after setup)
- Key-based authentication is enforced
- Strict and minimal security group rules are applied

---

## âž¤ Terraform Outputs Usage

Terraform generates the following outputs:

- Proxy server public IP
- Application server private IP
- Database server private IP

These outputs are automatically reused for:

- Dynamic Ansible inventory generation
- Proxy configuration
- Application-to-database connectivity

---

## âž¤ Verification

- Application is accessible at:
```
http://<Proxy_Public_IP>:81
```

- Web application loads successfully
- User data is inserted into the database
- Stored records are retrieved and displayed correctly
- Database connectivity verified from the private network
- Verification screenshots are available in the `images/` directory

---

## âž¤ Summary

This project demonstrates a **fully automated 3-Tier PHP application deployment on AWS** using Terraform and Ansible. The entire workflow, from infrastructure provisioning to application availability is executed through a **single command**, following real-world DevOps best practices.

The project showcases hands-on experience with Infrastructure as Code, configuration management, secure networking, and production-style DevOps automation.

---

